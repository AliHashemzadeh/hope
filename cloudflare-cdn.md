# استفاده از روش CloudFlare CDN

در این روش از یک تکنیک ساده استفاده می‌کنیم تا احتمال شناسایی سرور ما کمتر بشود. در حالت عادی بین دستگاه موبایل و سروری که راه‌اندازی کردید یک ارتباط مستقیم برقرار می‌شود. بدین صورت که دستگاه شما به پروکسی سرور اعلام می‌کند که قصد استفاده از چه سرویسی را دارد. بعد هم پروکسی سرور در نقش یک «واسط» با اتصال به آن سرویس، امکان این را فراهم می‌کند که بین گوشی و سرویس مقصد ارتباط برقرار شود. 

![image](https://user-images.githubusercontent.com/118040490/212413099-0d01cfb5-83cf-4873-b72d-28ed58e199ae.png)


گاهی به این روش ایرادی گرفته می‌شود و آن هم این است که اتصال مستقیم از داخل شبکه ایران به شبکه‌ای در خارج از کشور باعث لو رفتن IP سرور می‌شود و شانس مسدود شدن سرور بالا خواهد رفت.

برای رفع این نقص پیشنهاد می‌شود به جای اتصال مستقیم به سرور از یک واسط استفاده کنیم که در شبکه اینترنت ایران به عنوان واسطی معتمد شناخته می‌شود. اسم این واسط هم چیزی نیست جز شرکت معروف [Cloudflare](). با روش جدید، نمودار به شکل زیر تغییر خواهد کرد. می‌بینید که به جای اتصال مستقیم کلاینت به CloudFlare متصل می‌شود و از آنجا به پروکسی سرور متصل خواهیم شد. مزیت این روش این هست که فیلترچی هیچ‌وقت نخواهد فهمید که آدرس پروکسی سرور ما چی هست. تنها چیزی که خواهد دید برقراری اتصال بین دستگاهی در داخل با CloudFlare است.  

![image](https://user-images.githubusercontent.com/118040490/212414604-056e701c-936e-4db9-92e2-275e6ab3e845.png)


## پیش‌نیاز‌های استفاده از CDN
استفاده از روش CDN پیش‌نیاز‌هایی دارد:

۱. نیاز به ساخت یک [حساب در CloudFlare](https://dash.cloudflare.com/sign-up) دارید.  

۲. نیاز به domian داریم. 

۳. دامنه شما باید توسط nameserver های CloudFlare مدیریت شود. اگر دامنه را از Cloudflare تهیه کرده‌اید این‌کار به طور خود‌کار برای شما انجام می‌شود و نیاز به تغییر نیست. اگر دامنه را از ارائه‌دهنده‌ دیگری گرفته‌اید، لازم هست تا nameserver های دامنه را به آدرس‌‌های Cloudflare تغییر دهید. در گوگل پیدا کنید که چطور می‌توانید nameserver را تغییر دهید، با توجه به شرکت ارائه دهنده فرایند متفاوتی را باید طی کنید.  

۴. پروتکل پروکسی باید استفاده از WebSocket و یا WS را پشتیبانی بکند. در حال حاضر فقط VMESS و VLESS استفاده از WS را پشتیبانی می‌کنند. پیشنهاد ما فقط استفاده از VLESS می‌باشد. در نتیجه Trojan نمی‌تواند برای این روش استفاده شود.

۵. پلن رایگان CloudFlare اجازه انتقال ترافیک روی پورت‌های محدود و مشخصی را می‌دهد. در نتیجه از هر پورتی نمی‌توانید استفاده کنید. اگر از TLS و یا XTLS استفاده می‌کنید باید کانفیگ را بر روی یکی از پورت‌های HTTPS تعریف کرده باشید. در غیر‌این‌ صورت از پورت‌های HTTP می‌توانید فقط استفاده کنید.

![image](https://user-images.githubusercontent.com/118040490/212417661-6c82e3fe-889b-47ef-9f46-aa6b08ac9849.png)

۶. اگر از TLS و یا XTLS استفاده می‌کنید، حتما باید از certificate معتبر استفاده کنید. [روش تهیه certificate معتبر](https://github.com/iranxray/hope/blob/main/create-tsl-certificate.md) را پیش‌تر توضیح داده‌ایم.
